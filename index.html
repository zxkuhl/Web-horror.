<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>SYSTEM_COMPROMISED</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/clmtrackr@1.1.2/build/clmtrackr.min.js"></script>
    <style>
        :root { --glitch-green: #00ff41; --danger-red: #ff0000; }
        body { background: #050505; color: var(--glitch-green); font-family: 'Courier New', monospace; margin: 0; overflow: hidden; }
        
        #ui-layer { display: grid; grid-template-columns: 1fr 350px; height: 100vh; padding: 20px; gap: 20px; }
        
        /* Terminal & Chat styling */
        .window { border: 1px solid var(--glitch-green); background: rgba(0, 10, 0, 0.85); display: flex; flex-direction: column; }
        .title-bar { background: var(--glitch-green); color: black; padding: 4px 10px; font-size: 0.7rem; font-weight: bold; }
        
        /* The Camera/Bot Box */
        #bot-view { position: relative; width: 100%; height: 250px; background: black; border-top: 2px solid var(--danger-red); overflow: hidden; }
        #canvas-container { position: absolute; top: 0; left: 0; width: 100%; height: 100%; transform: scaleX(-1); /* Mirror view */ }

        #chat-history { flex-grow: 1; padding: 10px; font-size: 0.8rem; overflow-y: auto; height: 150px; }
        #chat-input { background: transparent; border: none; border-top: 1px solid #333; color: white; padding: 10px; outline: none; }
        
        .status-text { color: var(--danger-red); font-size: 0.7rem; padding: 5px; animation: blink 1s infinite; }
        @keyframes blink { 0% { opacity: 1; } 50% { opacity: 0; } }
    </style>
</head>
<body>

<div id="ui-layer">
    <div class="window">
        <div class="title-bar">LOG_VIEWER.EXE</div>
        <div style="padding: 20px;">
            <p>> [SYSTEM] Camera Feed hijacking successful...</p>
            <p>> [SYSTEM] Face identified as: <span style="color:white">SUBJECT_01</span></p>
            <p>> [SYSTEM] Don't blink.</p>
        </div>
    </div>

    <div class="window">
        <div class="title-bar">BOT_OBSERVER_V1</div>
        <div id="chat-history">
            <div style="color:gray">System: Waiting for biometric link...</div>
        </div>
        
        <div id="bot-view">
            <div id="canvas-container"></div>
            <div style="position:absolute; bottom:5px; right:5px; color:red; font-size:10px;">REC ‚óè</div>
        </div>
        
        <div class="status-text">TARGET_LOCKED: TRACKING_FACE...</div>
        <input type="text" id="chat-input" placeholder="TALK TO IT...">
    </div>
</div>

<script>
    let video;
    let tracker;
    let canvas;

    function setup() {
        // Create canvas inside the bot-view container
        const container = document.getElementById('canvas-container');
        canvas = createCanvas(350, 250);
        canvas.parent('canvas-container');

        // Setup Webcam
        video = createCapture(VIDEO);
        video.size(350, 250);
        video.hide();

        // Setup Tracker
        tracker = new clm.tracker();
        tracker.init();
        tracker.start(video.elt);
    }

    function draw() {
        // Draw the video frame to the canvas
        image(video, 0, 0, width, height);
        
        // Get face positions
        let positions = tracker.getCurrentPosition();

        if (positions.length > 0) {
            // Draw the "Lil Face Tracking Circle"
            // positions[1] is left side, positions[13] is right side
            // We'll use the nose (positions[62]) as the center
            let nose = positions[62];
            
            noFill();
            stroke(255, 0, 0); // Scary red circle
            strokeWeight(2);
            
            // Draw the main tracking ring
            ellipse(nose[0], nose[1], 120, 150);
            
            // Draw some "targeting" lines
            line(nose[0] - 70, nose[1], nose[0] - 50, nose[1]);
            line(nose[0] + 70, nose[1], nose[0] + 50, nose[1]);
            
            // Add a "Subject identified" label that follows the face
            fill(255, 0, 0);
            noStroke();
            textSize(12);
            text("ID: HUMAN_PREY", nose[0] - 50, nose[1] - 80);
        }
    }

    // Simple Chat Logic
    const chatInput = document.getElementById('chat-input');
    const history = document.getElementById('chat-history');

    chatInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
            history.innerHTML += `<div>You: ${chatInput.value}</div>`;
            const val = chatInput.value.toLowerCase();
            chatInput.value = '';

            setTimeout(() => {
                let response = "I see you...";
                if(val.includes("who")) response = "I am the ghost in the machine.";
                if(val.includes("hello")) response = "We've been waiting for you.";
                
                history.innerHTML += `<div style="color:red">BOT: ${response}</div>`;
                history.scrollTop = history.scrollHeight;
            }, 800);
        }
    });
</script>

</body>
</html>
